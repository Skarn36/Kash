<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KASH ‚Äî Minhas Listas</title>
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="app">
      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="brand">
          <div class="brand__name">KASH</div>
          <div class="brand__sub">Financial Ecosystem</div>
        </div>

        <nav class="nav">
          <a class="nav__item" href="index.html">
            <span class="nav__dot"></span>
            <span>Dashboard</span>
          </a>

          <a class="nav__item is-active" href="minhas-listas.html">
            <span class="nav__icon">‚â°</span>
            <span>Minhas Listas</span>
          </a>

          <a class="nav__item" href="sugestoes-kash.html">
  <span class="nav__icon">‚óé</span>
  <span>Sugest√µes KASH</span>
</a>

          <a class="nav__item" href="relatorios.html">
            <span class="nav__icon">‚Üó</span>
            <span>Relat√≥rios</span>
          </a>

          <a class="nav__item" href="contas.html">
            <span class="nav__icon">‚ñ¶</span>
            <span>Contas</span>
          </a>

          <a class="nav__item" href="#">
            <span class="nav__icon">‚ó¥</span>
            <span>Categorias</span>
          </a>
        </nav>

        <div class="sidebar__fade"></div>
      </aside>

      <!-- MAIN -->
      <main class="main">
        <!-- CONTENT -->
        <section class="content">
          <div class="page-head">
            <div>
              <h1 class="page-title">Minhas Listas</h1>
              <p class="page-subtitle">Gerencie suas listas com intelig√™ncia artificial</p>
            </div>

            <div class="page-icons">
              <button class="icon-btn" aria-label="Notifica√ß√µes">üîî</button>
              <button class="icon-btn" aria-label="Ajuda">?</button>
            </div>
          </div>

          <section class="ai-panel">
            <div class="ai-badge">ü™Ñ</div>

            <div class="ai-panel__body">
              <div class="ai-input-wrap">
                <input
                  class="ai-input"
                  placeholder='Digite aqui: "Criar lista de viagem para fim de semana" ou "Otimizar minha lista de compras".'
                />
                <button class="ai-cta">Criar com IA</button>
              </div>

              <p class="ai-hint">‚öô A IA Kash pode criar, otimizar e sugerir melhorias para suas listas</p>
            </div>
          </section>

          <div class="row-head">
            <div>
              <h2 class="h2">Suas Listas</h2>
              <p class="muted"><span id="listsCount">6</span> listas ativas</p>
            </div>

            <div class="row-actions">
              <button class="btn-ghost">
                <span class="btn-ico">‚è∑</span> Filtrar
              </button>
              <button class="btn-primary" id="btnNovaLista" type="button">
                <span class="plus">Ôºã</span> Nova Lista
              </button>
            </div>
          </div>

          <!-- GRID: 6 CARDS (igual ao print) -->
          <div class="list-grid" id="listsGrid">
            <!-- 1 -->
            <article class="list-card">
              <div class="lc-top">
                <div style="display:flex; gap:10px; align-items:center;">
                  <div class="lc-icon is-blue">üõí</div>
                  <div>
                    <div class="lc-title">Supermercado</div>
                    <div class="lc-meta">23 itens</div>
                  </div>
                </div>
                <button class="kebab" aria-label="Menu">‚ãÆ</button>
              </div>

              <div class="ai-suggest">
                <div class="ai-suggest__label">‚óé Sugest√£o IA</div>
                <div class="ai-suggest__text">Compre √†s ter√ßas-feiras para melhores pre√ßos</div>
              </div>

              <div class="lc-progress">
                <div class="lc-progress__row">
                  <span>Progresso</span>
                  <span class="pct">65%</span>
                </div>
                <div class="bar">
                  <div class="bar__fill is-green" style="width:65%"></div>
                </div>
              </div>

              <div class="lc-bottom">
                <div>
                  <div class="lc-bottom__label">Custo estimado</div>
                  <div class="lc-money">R$ 342,50</div>
                </div>
                <span class="pill-status is-green">Ativa</span>
              </div>
            </article>

            <!-- 2 -->
            <article class="list-card">
              <div class="lc-top">
                <div style="display:flex; gap:10px; align-items:center;">
                  <div class="lc-icon is-purple">‚úàÔ∏è</div>
                  <div>
                    <div class="lc-title">Viagem Lisboa</div>
                    <div class="lc-meta">15 itens</div>
                  </div>
                </div>
                <button class="kebab" aria-label="Menu">‚ãÆ</button>
              </div>

              <div class="ai-suggest">
                <div class="ai-suggest__label">‚óé Sugest√£o IA</div>
                <div class="ai-suggest__text">Reserve voos 3 semanas antes para economizar 25%</div>
              </div>

              <div class="lc-progress">
                <div class="lc-progress__row">
                  <span>Progresso</span>
                  <span class="pct">40%</span>
                </div>
                <div class="bar">
                  <div class="bar__fill is-yellow" style="width:40%"></div>
                </div>
              </div>

              <div class="lc-bottom">
                <div>
                  <div class="lc-bottom__label">Custo estimado</div>
                  <div class="lc-money">R$ 8.450,00</div>
                </div>
                <span class="pill-status is-blue">Planejando</span>
              </div>
            </article>

            <!-- 3 -->
            <article class="list-card">
              <div class="lc-top">
                <div style="display:flex; gap:10px; align-items:center;">
                  <div class="lc-icon is-green">üè†</div>
                  <div>
                    <div class="lc-title">Reforma Casa</div>
                    <div class="lc-meta">42 itens</div>
                  </div>
                </div>
                <button class="kebab" aria-label="Menu">‚ãÆ</button>
              </div>

              <div class="ai-suggest">
                <div class="ai-suggest__label">‚óé Sugest√£o IA</div>
                <div class="ai-suggest__text">Compre 3 fornecedores para economizar at√© 18%</div>
              </div>

              <div class="lc-progress">
                <div class="lc-progress__row">
                  <span>Progresso</span>
                  <span class="pct">80%</span>
                </div>
                <div class="bar">
                  <div class="bar__fill is-yellow" style="width:80%"></div>
                </div>
              </div>

              <div class="lc-bottom">
                <div>
                  <div class="lc-bottom__label">Custo estimado</div>
                  <div class="lc-money">R$ 15.200,00</div>
                </div>
                <span class="pill-status is-green">Ativa</span>
              </div>
            </article>

            <!-- 4 -->
            <article class="list-card">
              <div class="lc-top">
                <div style="display:flex; gap:10px; align-items:center;">
                  <div class="lc-icon is-red">‚ù§Ô∏è</div>
                  <div>
                    <div class="lc-title">Anivers√°rio M√£e</div>
                    <div class="lc-meta">8 itens</div>
                  </div>
                </div>
                <button class="kebab" aria-label="Menu">‚ãÆ</button>
              </div>

              <div class="ai-suggest">
                <div class="ai-suggest__label">‚óé Sugest√£o IA</div>
                <div class="ai-suggest__text">Reserve restaurante com 2 semanas de anteced√™ncia</div>
              </div>

              <div class="lc-progress">
                <div class="lc-progress__row">
                  <span>Progresso</span>
                  <span class="pct">30%</span>
                </div>
                <div class="bar">
                  <div class="bar__fill is-yellow" style="width:30%"></div>
                </div>
              </div>

              <div class="lc-bottom">
                <div>
                  <div class="lc-bottom__label">Custo estimado</div>
                  <div class="lc-money">R$ 1.850,00</div>
                </div>
                <span class="pill-status is-blue">Planejando</span>
              </div>
            </article>

            <!-- 5 -->
            <article class="list-card">
              <div class="lc-top">
                <div style="display:flex; gap:10px; align-items:center;">
                  <div class="lc-icon is-yellow">üéì</div>
                  <div>
                    <div class="lc-title">Cursos Online</div>
                    <div class="lc-meta">5 itens</div>
                  </div>
                </div>
                <button class="kebab" aria-label="Menu">‚ãÆ</button>
              </div>

              <div class="ai-suggest">
                <div class="ai-suggest__label">‚óé Sugest√£o IA</div>
                <div class="ai-suggest__text">Black Friday: economize at√© 40% em cursos</div>
              </div>

              <div class="lc-progress">
                <div class="lc-progress__row">
                  <span>Progresso</span>
                  <span class="pct">20%</span>
                </div>
                <div class="bar">
                  <div class="bar__fill is-yellow" style="width:20%"></div>
                </div>
              </div>

              <div class="lc-bottom">
                <div>
                  <div class="lc-bottom__label">Custo estimado</div>
                  <div class="lc-money">R$ 2.400,00</div>
                </div>
                <span class="pill-status is-blue">Planejando</span>
              </div>
            </article>

            <!-- 6 -->
            <article class="list-card">
              <div class="lc-top">
                <div style="display:flex; gap:10px; align-items:center;">
                  <div class="lc-icon is-pink">üèãÔ∏è</div>
                  <div>
                    <div class="lc-title">Academia</div>
                    <div class="lc-meta">12 itens</div>
                  </div>
                </div>
                <button class="kebab" aria-label="Menu">‚ãÆ</button>
              </div>

              <div class="ai-suggest">
                <div class="ai-suggest__label">‚óé Sugest√£o IA</div>
                <div class="ai-suggest__text">Planos anuais: economize 30% vs mensais</div>
              </div>

              <div class="lc-progress">
                <div class="lc-progress__row">
                  <span>Progresso</span>
                  <span class="pct">90%</span>
                </div>
                <div class="bar">
                  <div class="bar__fill is-yellow" style="width:90%"></div>
                </div>
              </div>

              <div class="lc-bottom">
                <div>
                  <div class="lc-bottom__label">Custo estimado</div>
                  <div class="lc-money">R$ 1.680,00</div>
                </div>
                <span class="pill-status is-green">Ativa</span>
              </div>
            </article>
          </div>

          <!-- INSIGHTS (2 cards) -->
          <section class="insights">
            <h2 class="h2">Insights IA Kash</h2>

            <div class="insights-grid">
              <article class="insight-card">
                <div class="ins-icon is-yellow">üìä</div>
                <div>
                  <div class="ins-title">Economia Potencial</div>
                  <div class="ins-text">
                    Seguindo as sugest√µes da IA, voc√™ pode economizar at√© R$ 1.245,00 este m√™s
                  </div>
                  <a class="ins-link" href="#">Ver detalhes ‚Üí</a>
                </div>
              </article>

              <article class="insight-card">
                <div class="ins-icon is-yellow2">üóìÔ∏è</div>
                <div>
                  <div class="ins-title">Melhor Momento</div>
                  <div class="ins-text">
                    Ter√ßa-feira √© o melhor dia para compras de supermercado com descontos m√©dios de 12%
                  </div>
                  <a class="ins-link" href="#">Agendar lembrete ‚Üí</a>
                </div>
              </article>
            </div>
          </section>
        </section>
      </main>
    </div>

    <!-- ===== MODAL: NOVA LISTA ===== -->
<div class="modal" id="modalNovaLista" aria-hidden="true">
  <div class="modal__backdrop" data-close="1"></div>

  <div class="modal__panel" role="dialog" aria-modal="true" aria-label="Criar nova lista">
    <div class="modal__top">
      <div>
        <div class="modal__title">Nova Lista</div>
        <div class="modal__subtitle">Defina nome, itens e or√ßamento dispon√≠vel</div>
      </div>

      <button class="modal__close" type="button" data-close="1" aria-label="Fechar">‚úï</button>
    </div>

    <div class="modal__body">
      <div class="form-grid">
        <div class="field">
          <label>Nome da lista</label>
          <input id="nl_nome" type="text" placeholder="Ex.: Reforma Casa" />
        </div>

        <div class="field">
          <label>Valor dispon√≠vel (R$)</label>
          <input id="nl_disponivel" type="text" inputmode="decimal" placeholder="Ex.: 1500,00" />
        </div>
      </div>

      <div class="items-box">
        <div class="items-box__top">
          <div class="items-box__title">Itens</div>
          <button class="btn-ghost btn-ghost--sm" id="btnAddItem" type="button">
            <span class="btn-ico">Ôºã</span> Adicionar item
          </button>
        </div>

        <div class="items-table" id="itemsTable">
          <!-- Linhas de itens entram via JS -->
        </div>
      </div>

      <div class="summary">
        <div class="sum-card">
          <div class="sum-label">Custo estimado</div>
          <div class="sum-value" id="nl_estimado">R$ 0,00</div>
        </div>

        <div class="sum-card">
          <div class="sum-label">Progresso</div>
          <div class="sum-value"><span id="nl_pct">0%</span></div>
          <div class="bar bar--sm">
            <div class="bar__fill is-yellow" id="nl_bar" style="width:0%"></div>
          </div>
        </div>
      </div>

      <div class="modal__actions">
        <button class="btn-ghost" type="button" data-close="1">Cancelar</button>
        <button class="btn-primary" type="button" id="btnSalvarLista">
          <span class="plus">Ôºã</span> Criar Lista
        </button>
      </div>

      <div class="tiny-note">
        * O sistema gera um <b>ID</b> automaticamente (pronto pra banco depois).
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  // ===== Helpers =====
  const qs = (s, root=document) => root.querySelector(s);
  const qsa = (s, root=document) => [...root.querySelectorAll(s)];

  const parseBRL = (str) => {
    if (!str) return 0;
    const cleaned = String(str)
      .replace(/\s/g, "")
      .replace("R$", "")
      .replace(/\./g, "")
      .replace(",", ".");
    const n = Number(cleaned);
    return Number.isFinite(n) ? n : 0;
  };

  const formatBRL = (n) => {
    const v = Number(n || 0);
    return v.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
  };

  // ID "ok" pro front (pra virar ID de banco depois)
  const makeId = () =>
    "lst_" + Date.now().toString(36) + "_" + Math.random().toString(36).slice(2, 8);

  // ===== Elementos =====
  const btnNova = qs("#btnNovaLista");
  const modal = qs("#modalNovaLista");
  const grid = qs("#listsGrid");
  const countEl = qs("#listsCount");

  const inNome = qs("#nl_nome");
  const inDisp = qs("#nl_disponivel");
  const itemsTable = qs("#itemsTable");
  const btnAddItem = qs("#btnAddItem");
  const btnSalvar = qs("#btnSalvarLista");

  const estEl = qs("#nl_estimado");
  const pctEl = qs("#nl_pct");
  const barEl = qs("#nl_bar");

  // ===== State =====
  let items = [];

  // Carrega do localStorage (sem backend, mas ‚Äúlembra‚Äù no navegador)
  const LS_KEY = "kash_lists_v1";
  const loadLists = () => {
    try { return JSON.parse(localStorage.getItem(LS_KEY) || "[]"); }
    catch { return []; }
  };
  const saveLists = (lists) => localStorage.setItem(LS_KEY, JSON.stringify(lists));

  const updateCount = () => {
    // Conta: cards fixos do HTML + cards criados
    const total = qsa(".list-card", grid).length;
    countEl.textContent = String(total);
  };

  // ===== Modal open/close =====
  const openModal = () => {
    modal.classList.add("is-open");
    modal.setAttribute("aria-hidden", "false");
  };
  const closeModal = () => {
    modal.classList.remove("is-open");
    modal.setAttribute("aria-hidden", "true");
  };

  modal.addEventListener("click", (e) => {
    const t = e.target;
    if (t && t.dataset && t.dataset.close) closeModal();
  });

  btnNova?.addEventListener("click", () => {
    // reset
    inNome.value = "";
    inDisp.value = "";
    items = [{ name: "", value: 0 }];
    renderItems();
    recalc();
    openModal();
  });

  // ===== Items UI =====
  const renderItems = () => {
    itemsTable.innerHTML = items.map((it, idx) => `
      <div class="item-row" data-idx="${idx}">
        <input class="item-name" type="text" placeholder="Item ${idx+1} (ex.: Tinta)" value="${escapeHtml(it.name)}" />
        <input class="item-value" type="text" inputmode="decimal" placeholder="0,00" value="${it.value ? String(it.value).replace(".", ",") : ""}" />
        <button class="item-del" type="button" title="Remover">‚úï</button>
      </div>
    `).join("");
  };

  const escapeHtml = (s) =>
    String(s || "").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;");

  const recalc = () => {
    const totalEstimado = items.reduce((acc, it) => acc + (Number(it.value) || 0), 0);
    const disponivel = parseBRL(inDisp.value);

    const pct = totalEstimado > 0 ? Math.min(100, Math.max(0, (disponivel / totalEstimado) * 100)) : 0;
    const pctRound = Math.round(pct);

    estEl.textContent = formatBRL(totalEstimado);
    pctEl.textContent = pctRound + "%";
    barEl.style.width = pctRound + "%";
  };

  btnAddItem.addEventListener("click", () => {
    items.push({ name: "", value: 0 });
    renderItems();
    recalc();
  });

  itemsTable.addEventListener("input", (e) => {
    const row = e.target.closest(".item-row");
    if (!row) return;
    const idx = Number(row.dataset.idx);

    if (e.target.classList.contains("item-name")) {
      items[idx].name = e.target.value;
    }
    if (e.target.classList.contains("item-value")) {
      items[idx].value = parseBRL(e.target.value);
    }
    recalc();
  });

  itemsTable.addEventListener("click", (e) => {
    if (!e.target.classList.contains("item-del")) return;
    const row = e.target.closest(".item-row");
    const idx = Number(row.dataset.idx);

    items.splice(idx, 1);
    if (items.length === 0) items.push({ name: "", value: 0 });

    renderItems();
    recalc();
  });

  inDisp.addEventListener("input", recalc);

  // ===== Create card =====
  const pickIcon = (name) => {
    const n = (name || "").toLowerCase();
    if (n.includes("viagem")) return { icon:"‚úàÔ∏è", cls:"is-purple", bar:"is-yellow" };
    if (n.includes("super") || n.includes("mercado")) return { icon:"üõí", cls:"is-blue", bar:"is-green" };
    if (n.includes("reforma") || n.includes("casa")) return { icon:"üè†", cls:"is-green", bar:"is-yellow" };
    if (n.includes("curso")) return { icon:"üéì", cls:"is-yellow", bar:"is-yellow" };
    if (n.includes("anivers")) return { icon:"‚ù§Ô∏è", cls:"is-red", bar:"is-yellow" };
    return { icon:"üìã", cls:"is-blue", bar:"is-yellow" };
  };

  const createCardHtml = ({ id, title, itemsCount, estimated, pct, icon, iconCls, barCls, statusText, statusCls }) => {
    return `
      <article class="list-card" data-list-id="${id}">
        <div class="lc-top">
          <div style="display:flex; gap:10px; align-items:center;">
            <div class="lc-icon ${iconCls}">${icon}</div>
            <div>
              <div class="lc-title">${escapeHtml(title)}</div>
              <div class="lc-meta">${itemsCount} itens</div>
            </div>
          </div>
          <button class="kebab" aria-label="Menu">‚ãÆ</button>
        </div>

        <div class="ai-suggest">
          <div class="ai-suggest__label">‚óé Sugest√£o IA</div>
          <div class="ai-suggest__text">Adicione itens essenciais primeiro para estimar melhor o custo total</div>
        </div>

        <div class="lc-progress">
          <div class="lc-progress__row">
            <span>Progresso</span>
            <span class="pct">${pct}%</span>
          </div>
          <div class="bar">
            <div class="bar__fill ${barCls}" style="width:${pct}%"></div>
          </div>
        </div>

        <div class="lc-bottom">
          <div>
            <div class="lc-bottom__label">Custo estimado</div>
            <div class="lc-money">${formatBRL(estimated)}</div>
          </div>
          <span class="pill-status ${statusCls}">${escapeHtml(statusText)}</span>
        </div>
      </article>
    `;
  };

  btnSalvar.addEventListener("click", () => {
    const title = (inNome.value || "").trim();
    const disponivel = parseBRL(inDisp.value);

    const cleanItems = items
      .map(i => ({ name: (i.name||"").trim(), value: Number(i.value)||0 }))
      .filter(i => i.name || i.value > 0);

    const estimated = cleanItems.reduce((a, i) => a + i.value, 0);
    const pct = estimated > 0 ? Math.round(Math.min(100, Math.max(0, (disponivel / estimated) * 100))) : 0;

    if (!title) {
      inNome.focus();
      return;
    }

    const id = makeId();

    const iconPick = pickIcon(title);

    const statusText = pct >= 100 ? "Ativa" : "Planejando";
    const statusCls = pct >= 100 ? "is-green" : "is-blue";

    // Adiciona no DOM (no topo)
    grid.insertAdjacentHTML("afterbegin", createCardHtml({
      id,
      title,
      itemsCount: cleanItems.length || 0,
      estimated,
      pct,
      icon: iconPick.icon,
      iconCls: iconPick.cls,
      barCls: iconPick.bar,
      statusText,
      statusCls
    }));

    // Persiste no navegador (sem backend)
    const lists = loadLists();
    lists.unshift({
      id,
      title,
      disponivel,
      items: cleanItems,
      estimated,
      pct,
      createdAt: new Date().toISOString()
    });
    saveLists(lists);

    updateCount();
    closeModal();
  });

  // ===== Renderiza listas salvas ao carregar =====
  const boot = () => {
    const lists = loadLists();
    if (lists.length) {
      // coloca as salvas no topo, mantendo as 6 ‚Äúfixas‚Äù abaixo
      [...lists].reverse().forEach((l) => {
        const iconPick = pickIcon(l.title);
        const statusText = (l.pct >= 100) ? "Ativa" : "Planejando";
        const statusCls = (l.pct >= 100) ? "is-green" : "is-blue";

        grid.insertAdjacentHTML("afterbegin", createCardHtml({
          id: l.id,
          title: l.title,
          itemsCount: (l.items?.length || 0),
          estimated: l.estimated || 0,
          pct: l.pct || 0,
          icon: iconPick.icon,
          iconCls: iconPick.cls,
          barCls: iconPick.bar,
          statusText,
          statusCls
        }));
      });
    }
    updateCount();
  };

  boot();
})();
</script>

  </body>
</html>
