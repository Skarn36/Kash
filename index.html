<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KASH ‚Äî Dashboard</title>
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>



    <div class="app">
      
      <!-- SIDEBAR -->
<aside class="sidebar">
  <div class="brand">
    <div class="brand__name">KASH</div>
    <div class="brand__sub">Financial Ecosystem</div>
  </div>

  <nav class="nav">
    <a class="nav__item is-active" href="index.html">
      <span class="nav__dot"></span>
      <span>Dashboard</span>
    </a>

    <a class="nav__item" href="minhas-listas.html">
      <span class="nav__icon">‚â°</span>
      <span>Minhas Listas</span>
    </a>

    <a class="nav__item" href="sugestoes-kash.html">
      <span class="nav__icon">‚óé</span>
      <span>Sugest√µes KASH</span>
    </a>

    <a class="nav__item" href="relatorios.html">
      <span class="nav__icon">‚Üó</span>
      <span>Relat√≥rios</span>
    </a>

    <a class="nav__item" href="contas.html">
      <span class="nav__icon">‚ñ¶</span>
      <span>Contas</span>
    </a>

    <a class="nav__item" href="categorias.html">
      <span class="nav__icon">‚ó¥</span>
      <span>Categorias</span>
    </a>
  </nav>

  <div class="sidebar__fade"></div>
</aside>


      <!-- MAIN -->
      <main class="main">
        <!-- TOPBAR -->
        <header class="topbar">
          <div class="search">
            <span class="search__icon">‚åï</span>
            <input
              class="search__input"
              type="text"
              placeholder="Buscar transa√ß√µes, listas ou categorias..."
            />
          </div>

          <div class="topbar__right">
            <a href="notificacoes.html" class="icon-btn" aria-label="Notifica√ß√µes">
              üîî
              <span class="badge">3</span>
            </a>

            <a class="top-user" href="perfil.html">
              <div class="top-user__text">
                <div class="top-user__name">Ana Silva</div>
                <div class="top-user__plan">Premium</div>
              </div>

              <div class="top-user__avatar" aria-label="Avatar do usu√°rio"></div>
            </a>

            <div class="user-area">
              <button class="logout-btn" onclick="logout()">Sair</button>
            </div>

          </div>
        </header>

        <!-- CONTENT -->
        <section class="content">
          
          <!-- Heading row -->
          <div class="heading-row">
            <div>
              <h1 class="title">Vis√£o Geral Financeira</h1>
              <p class="subtitle">Atualizado h√° 5 minutos</p>
            </div>

            <div class="actions">
              <button class="select">
                <span>√öltimos 30 dias</span>
                <span class="caret">‚ñæ</span>
              </button>

              <button id="btnNovaTransacao" class="btn-primary">
                <span class="plus">Ôºã</span>
                Nova Transa√ß√£o
              </button>
            </div>
          </div>

          <!-- Stat cards -->
          <div class="cards">
            <article class="card">
              <div class="card__head">
                <span class="card__label">PATRIM√îNIO TOTAL</span>
                <span class="pill is-green">‚ñ†</span>
              </div>
              <div class="card__value">R$ 48.850</div>
              <div class="card__delta is-up">‚Üë 12.5% <span>vs m√™s anterior</span></div>
            </article>

            <article class="card">
              <div class="card__head">
                <span class="card__label">RECEITAS</span>
                <span class="pill is-green2">‚Üó</span>
              </div>
              <div class="card__value">R$ 12.400</div>
              <div class="card__delta is-up">‚Üë 8.2% <span>vs m√™s anterior</span></div>
            </article>

            <article class="card">
              <div class="card__head">
                <span class="card__label">DESPESAS</span>
                <span class="pill is-red">‚Üò</span>
              </div>
              <div class="card__value">R$ 8.650</div>
              <div class="card__delta is-down">‚Üì 3.1% <span>vs m√™s anterior</span></div>
            </article>

            <article class="card">
              <div class="card__head">
                <span class="card__label">TAXA DE ECONOMIA</span>
                <span class="pill is-gold">$</span>
              </div>
              <div class="card__value">30.2%</div>
              <div class="card__delta is-neutral">‚Äî 0.0% <span>vs m√™s anterior</span></div>
            </article>
          </div>

          <!-- Big chart card -->
          <section class="panel">
            <div class="panel__top">
              <h2 class="panel__title">Evolu√ß√£o Patrimonial</h2>

              <div class="tabs" role="tablist" aria-label="S√©ries do gr√°fico">
                <button class="tab" role="tab" aria-selected="false">Receitas</button>
                <button class="tab" role="tab" aria-selected="false">Despesas</button>
                <button class="tab" role="tab" aria-selected="false">L√≠quido</button>
              </div>
            </div>

            <!-- Placeholder do gr√°fico -->
            <div class="chart">
              <div class="chart__grid"></div>
              <div class="chart__x">
                <span>Ago</span>
                <span>Set</span>
              </div>
            </div>
          </section>
          
          <section class="content">
  <!-- Linha de t√≠tulo (bem discreta aqui, como na imagem) -->
  <div class="heading-row heading-row--compact">
    <div></div>
    <a class="panel__link" href="minhas-listas.html">Ver Todas ‚Üí</a>

  </div>

  <div class="grid-2">
    <!-- COLUNA ESQUERDA -->
    <section class="stack">
      <div class="section-title">
        <h2>KASH AI Engine</h2>
        <span class="hint">?</span>
      </div>

      <!-- Card 1 -->
      <article class="ai-card ai-card--highlight">
        <div class="ai-card__top">
          <div class="ai-icon ai-icon--gold">üí°</div>
          <div class="chip">AI</div>
        </div>

        <h3 class="ai-card__title">Oportunidade de Economia</h3>
        <p class="ai-card__desc">
          Reduza 18% em entretenimento e economize R$ 320/m√™s
        </p>

        <button class="ai-btn ai-btn--gold">Ver An√°lise Completa</button>
      </article>

      <!-- Card 2 -->
      <article class="ai-card">
        <div class="ai-card__top">
          <div class="ai-icon ai-icon--green">üìà</div>
        </div>

        <h3 class="ai-card__title">Padr√£o Identificado</h3>
        <p class="ai-card__desc">
          Gastos com alimenta√ß√£o aumentaram 22% nas √∫ltimas 3 semanas
        </p>

        <button class="ai-btn">Investigar</button>
      </article>

      <!-- Card 3 -->
      <article class="ai-card">
        <div class="ai-card__top">
          <div class="ai-icon ai-icon--blue">üéØ</div>
        </div>

        <h3 class="ai-card__title">Meta Sugerida</h3>
        <p class="ai-card__desc">
          Criar fundo de emerg√™ncia de R$ 15.000 em 8 meses
        </p>

        <button class="ai-btn">Criar Meta</button>
      </article>
    </section>

    <!-- COLUNA DIREITA -->
    <section class="list-panel">
      <div class="list-panel__head">
        <h2 class="list-panel__title">Gerenciador de Listas</h2>
      </div>

      <div class="table">
        <div class="table__head">
  <span>LISTA</span>
  <span>ITENS</span>
  <span>OR√áAMENTO</span>
  <span>PROGRESSO</span>
  <span>STATUS</span>
  <span></span>
</div>

<div id="dashListsRows"></div>

        <!-- Linha 1 -->
        <div class="row">
          <div class="cell cell--list">
            <div class="list-icon list-icon--blue">üõí</div>
            <div>
              <div class="list-name">Supermercado Janeiro</div>
              <div class="list-sub">Criado h√° 2 dias</div>
            </div>
          </div>

          <div class="cell">
            <div class="items">
              <div class="items__num">24</div>
              <div class="items__txt">itens</div>
            </div>
          </div>

          <div class="cell money">R$ 850,00</div>

          <div class="cell">
            <div class="progress">
              <div class="progress__bar">
                <div class="progress__fill is-blue" style="width: 68%"></div>
              </div>
              <div class="progress__pct">68%</div>
            </div>
          </div>

          <div class="cell">
            <span class="status is-warn">Em Andamento</span>
          </div>

          <div class="cell cell--menu">‚ãÆ</div>
        </div>

        <!-- Linha 2 -->
        <div class="row">
          <div class="cell cell--list">
            <div class="list-icon list-icon--purple">üè†</div>
            <div>
              <div class="list-name">Contas da Casa</div>
              <div class="list-sub">Criado h√° 5 dias</div>
            </div>
          </div>

          <div class="cell">
            <div class="items">
              <div class="items__num">12</div>
              <div class="items__txt">itens</div>
            </div>
          </div>

          <div class="cell money">R$ 1.280,00</div>

          <div class="cell">
            <div class="progress">
              <div class="progress__bar">
                <div class="progress__fill is-purple" style="width: 92%"></div>
              </div>
              <div class="progress__pct">92%</div>
            </div>
          </div>

          <div class="cell">
            <span class="status is-teal">Quase Completa</span>
          </div>

          <div class="cell cell--menu">‚ãÆ</div>
        </div>

        <!-- Linha 3 -->
        <div class="row">
          <div class="cell cell--list">
            <div class="list-icon list-icon--orange">‚úàÔ∏è</div>
            <div>
              <div class="list-name">Viagem F√©rias</div>
              <div class="list-sub">Criado h√° 12 dias</div>
            </div>
          </div>

          <div class="cell">
            <div class="items">
              <div class="items__num">8</div>
              <div class="items__txt">itens</div>
            </div>
          </div>

          <div class="cell money">R$ 3.500,00</div>

          <div class="cell">
            <div class="progress">
              <div class="progress__bar">
                <div class="progress__fill is-orange" style="width: 35%"></div>
              </div>
              <div class="progress__pct">35%</div>
            </div>
          </div>

          <div class="cell">
            <span class="status is-warn">Em Andamento</span>
          </div>

          <div class="cell cell--menu">‚ãÆ</div>
        </div>

        <!-- Linha 4 -->
        <div class="row">
          <div class="cell cell--list">
            <div class="list-icon list-icon--green">üèãÔ∏è</div>
            <div>
              <div class="list-name">Academia & Sa√∫de</div>
              <div class="list-sub">Criado h√° 18 dias</div>
            </div>
          </div>

          <div class="cell">
            <div class="items">
              <div class="items__num">6</div>
              <div class="items__txt">itens</div>
            </div>
          </div>

          <div class="cell money">R$ 450,00</div>

          <div class="cell">
            <div class="progress">
              <div class="progress__bar">
                <div class="progress__fill is-green" style="width: 100%"></div>
              </div>
              <div class="progress__pct">100%</div>
            </div>
          </div>

          <div class="cell">
            <span class="status is-green">Completa</span>
          </div>

          <div class="cell cell--menu">‚ãÆ</div>
        </div>

        <!-- CTA criar -->
        <button class="create-row" id="dashNovaLista">
  Ôºã Criar Nova Lista
</button>
      </div>
    </section>
  </div>
</section>
<!-- ===== Distribui√ß√£o + Transa√ß√µes ===== -->
<div class="grid-2 grid-2--wide">

  <!-- Distribui√ß√£o por Categoria -->
  <section class="panel panel--empty">
    <div class="panel__top">
      <h2 class="panel__title">Distribui√ß√£o por Categoria</h2>
      <a class="panel__link" href="#">Ver Detalhes</a>
    </div>

    <div class="chart chart--empty">
      <span>Gr√°fico n√£o dispon√≠vel</span>
    </div>
  </section>

  <!-- Transa√ß√µes Recentes -->
  <section class="panel">
    <div class="panel__top">
      <h2 class="panel__title">Transa√ß√µes Recentes</h2>
      <a class="panel__link" href="#">Ver Todas ‚Üí</a>
    </div>

    <div class="transactions" id="transactionsList">

      <div class="tx">
        <div class="tx__icon is-red">üçΩÔ∏è</div>
        <div class="tx__info">
          <div class="tx__name">Restaurante Italiano</div>
          <div class="tx__meta">Alimenta√ß√£o ‚Ä¢ Hoje 14:30</div>
        </div>
        <div class="tx__value is-neg">-R$ 185,00</div>
      </div>

      <div class="tx">
        <div class="tx__icon is-green">üìà</div>
        <div class="tx__info">
          <div class="tx__name">Freelance Design</div>
          <div class="tx__meta">Receita ‚Ä¢ Hoje 10:15</div>
        </div>
        <div class="tx__value is-pos">+R$ 2.400,00</div>
      </div>

      <div class="tx">
        <div class="tx__icon is-orange">‚õΩ</div>
        <div class="tx__info">
          <div class="tx__name">Posto Shell</div>
          <div class="tx__meta">Transporte ‚Ä¢ Ontem 18:45</div>
        </div>
        <div class="tx__value is-neg">-R$ 220,00</div>
      </div>

      <div class="tx">
        <div class="tx__icon is-blue">üõí</div>
        <div class="tx__info">
          <div class="tx__name">Amazon Prime</div>
          <div class="tx__meta">Compras ‚Ä¢ Ontem 12:20</div>
        </div>
        <div class="tx__value is-neg">-R$ 89,90</div>
      </div>

      <div class="tx">
        <div class="tx__icon is-purple">üé¨</div>
        <div class="tx__info">
          <div class="tx__name">Netflix Premium</div>
          <div class="tx__meta">Entretenimento ‚Ä¢ 28 Dez</div>
        </div>
        <div class="tx__value is-neg">-R$ 55,90</div>
      </div>

      <div class="tx">
        <div class="tx__icon is-yellow">‚ö°</div>
        <div class="tx__info">
          <div class="tx__name">Conta de Luz</div>
          <div class="tx__meta">Utilidades ‚Ä¢ 27 Dez</div>
        </div>
        <div class="tx__value is-neg">-R$ 185,00</div>
      </div>

    </div>
  </section>
</div>

<!-- ===== Metas Financeiras ===== -->
<section class="goals">
  <div class="goals__head">
    <h2>Metas Financeiras</h2>
    <a href="#">Gerenciar Metas</a>
  </div>

  <div class="goals__grid">

    <article class="goal">
      <div class="goal__top">
        <div class="goal__icon is-green">üåç</div>
        <span class="goal__pct is-green">78%</span>
      </div>

      <h3>Viagem Europa</h3>
      <p>R$ 7.800 de R$ 10.000</p>

      <div class="bar">
        <div class="bar__fill is-green" style="width:78%"></div>
      </div>

      <span class="goal__meta">Faltam R$ 2.200 ‚Ä¢ 3 meses</span>
    </article>

    <article class="goal">
      <div class="goal__top">
        <div class="goal__icon is-blue">üöó</div>
        <span class="goal__pct is-blue">42%</span>
      </div>

      <h3>Carro Novo</h3>
      <p>R$ 21.000 de R$ 50.000</p>

      <div class="bar">
        <div class="bar__fill is-blue" style="width:42%"></div>
      </div>

      <span class="goal__meta">Faltam R$ 29.000 ‚Ä¢ 18 meses</span>
    </article>

    <article class="goal">
      <div class="goal__top">
        <div class="goal__icon is-yellow">üõ°Ô∏è</div>
        <span class="goal__pct is-yellow">15%</span>
      </div>

      <h3>Fundo Emerg√™ncia</h3>
      <p>R$ 2.250 de R$ 15.000</p>

      <div class="bar">
        <div class="bar__fill is-yellow" style="width:15%"></div>
      </div>

      <span class="goal__meta">Faltam R$ 12.750 ‚Ä¢ 12 meses</span>
    </article>

  </div>
</section>

        </section>

        
      </main>
    </div>

    <!-- Opcional -->
    <!-- <script src="app.js"></script> -->

    <div class="modal" id="trxModal" aria-hidden="true">
  <div class="modal__backdrop" data-close="1"></div>

  <div class="modal__card" role="dialog" aria-modal="true" aria-label="Nova Transa√ß√£o">
    <div class="modal__head">
      <div>
        <div class="modal__title">Nova Transa√ß√£o</div>
        <div class="modal__sub">Preencha os dados para adicionar em ‚ÄúTransa√ß√µes Recentes‚Äù</div>
      </div>
      <button class="modal__x" id="trxClose" aria-label="Fechar">√ó</button>
    </div>

    <form class="modal__form" id="trxForm">
      <div class="frow">
        <div class="ffield">
          <label>Nome / Descri√ß√£o</label>
          <input id="trxNome" type="text" placeholder="Ex: Restaurante Mexicano" required />
        </div>
        <div class="ffield">
          <label>Tipo</label>
          <select id="trxTipo" required>
            <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
            <option value="Transporte">Transporte</option>
            <option value="Compras">Compras</option>
            <option value="Entretenimento">Entretenimento</option>
            <option value="Utilidades">Utilidades</option>
            <option value="Sa√∫de">Sa√∫de</option>
            <option value="Receita">Receita</option>
          </select>
        </div>
      </div>

      <div class="frow">
        <div class="ffield">
          <label>Valor (R$)</label>
          <input id="trxValor" type="number" step="0.01" placeholder="67.00" required />
        </div>

        <div class="ffield">
          <label>Data</label>
          <input id="trxData" type="date" required />
        </div>

        <div class="ffield">
          <label>Hora</label>
          <input id="trxHora" type="time" required />
        </div>
      </div>

      <div class="modal__actions">
        <button class="btn-ghost" type="button" id="trxCancel">Cancelar</button>
        <button class="btn-primary" type="submit">Adicionar</button>
      </div>

      <div class="modal__hint">
        * O sistema gera um <b>ID √∫nico</b> (pronto para backend depois).
      </div>
    </form>
  </div>
</div>
<!-- ===== MODAL: NOVA LISTA ===== -->
<div class="modal" id="modalNovaLista" aria-hidden="true">
  <div class="modal__backdrop" data-close="1"></div>

  <div class="modal__panel" role="dialog" aria-modal="true" aria-label="Criar nova lista">
    <div class="modal__top">
      <div>
        <div class="modal__title">Nova Lista</div>
        <div class="modal__subtitle">Defina nome, itens e or√ßamento dispon√≠vel</div>
      </div>

      <button class="modal__close" type="button" data-close="1" aria-label="Fechar">‚úï</button>
    </div>

    <div class="modal__body">
      <div class="form-grid">
        <div class="field">
          <label>Nome da lista</label>
          <input id="nl_nome" type="text" placeholder="Ex.: Reforma Casa" />
        </div>

        <div class="field">
          <label>Valor dispon√≠vel (R$)</label>
          <input id="nl_disponivel" type="text" inputmode="decimal" placeholder="Ex.: 1500,00" />
        </div>
      </div>

      <div class="items-box">
        <div class="items-box__top">
          <div class="items-box__title">Itens</div>
          <button class="btn-ghost btn-ghost--sm" id="btnAddItem" type="button">
            <span class="btn-ico">Ôºã</span> Adicionar item
          </button>
        </div>

        <div class="items-table" id="itemsTable">
          <!-- Linhas de itens entram via JS -->
        </div>
      </div>

      <div class="summary">
        <div class="sum-card">
          <div class="sum-label">Custo estimado</div>
          <div class="sum-value" id="nl_estimado">R$ 0,00</div>
        </div>

        <div class="sum-card">
          <div class="sum-label">Progresso</div>
          <div class="sum-value"><span id="nl_pct">0%</span></div>
          <div class="bar bar--sm">
            <div class="bar__fill is-yellow" id="nl_bar" style="width:0%"></div>
          </div>
        </div>
      </div>

      <div class="modal__actions">
        <button class="btn-ghost" type="button" data-close="1">Cancelar</button>
        <button class="btn-primary" type="button" id="btnSalvarLista">
          <span class="plus">Ôºã</span> Criar Lista
        </button>
      </div>

      <div class="tiny-note">
        * O sistema gera um <b>ID</b> automaticamente (pronto pra banco depois).
      </div>
    </div>
  </div>

<script>
  // ===== Helpers =====
  const pad2 = (n) => String(n).padStart(2, "0");

  function formatBRL(valueNumber){
    const v = Number(valueNumber || 0);
    return v.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
  }

  function generateId(){
    // ID pronto pra backend (√∫nico o suficiente pro front)
    return "trx_" + Date.now().toString(36) + "_" + Math.random().toString(36).slice(2, 8);
  }

  function iconForType(tipo){
    // √çcones simples (como no seu layout)
    const map = {
      "Alimenta√ß√£o": "üçΩ",
      "Transporte": "‚õΩ",
      "Compras": "üõí",
      "Entretenimento": "üé¨",
      "Utilidades": "‚ö°",
      "Sa√∫de": "üíä",
      "Receita": "üìà",
    };
    return map[tipo] || "‚Ä¢";
  }

  function signForType(tipo, valor){
    const v = Number(valor);
    const isIncome = (tipo === "Receita");
    const amount = formatBRL(Math.abs(v));
    return isIncome ? `+${amount}` : `-${amount}`;
  }

  function classForType(tipo){
    return (tipo === "Receita") ? "is-plus" : "is-minus";
  }

  function loadTransacoes(){
    try{
      return JSON.parse(localStorage.getItem("kash_transacoes") || "[]");
    }catch(e){
      return [];
    }
  }

  function saveTransacoes(list){
    localStorage.setItem("kash_transacoes", JSON.stringify(list));
  }

  // ===== Render =====
  const recentesList = document.getElementById("transactionsList");

  function colorClassForType(tipo){
  const map = {
    "Alimenta√ß√£o": "is-red",
    "Receita": "is-green",
    "Transporte": "is-orange",
    "Compras": "is-blue",
    "Entretenimento": "is-purple",
    "Utilidades": "is-yellow",
    "Sa√∫de": "is-green"
  };
  return map[tipo] || "is-blue";
}

function valueClassForType(tipo){
  return (tipo === "Receita") ? "is-pos" : "is-neg";
}

function renderTransacaoItem(t){
  const wrapper = document.createElement("div");
  wrapper.className = "tx";
  wrapper.dataset.id = t.id;

  // "Alimenta√ß√£o ‚Ä¢ Hoje 21:00"
  const meta = `${t.tipo} ‚Ä¢ ${t.dataLabel} ${t.horaLabel || ""}`.trim();

  wrapper.innerHTML = `
    <div class="tx__icon ${colorClassForType(t.tipo)}">${iconForType(t.tipo)}</div>
    <div class="tx__info">
      <div class="tx__name">${t.nome}</div>
      <div class="tx__meta">${meta}</div>
    </div>
    <div class="tx__value ${valueClassForType(t.tipo)}">${signForType(t.tipo, t.valor)}</div>
  `;

  return wrapper;
}


  function renderRecentes(){
    if(!recentesList) return;

    // Mant√©m os itens fixos j√° existentes? Se voc√™ quiser limpar e renderizar s√≥ os do storage:
    // recentesList.innerHTML = "";

    const stored = loadTransacoes();

    // Renderiza do mais recente pro mais antigo
    stored.slice().reverse().forEach(t => {
      const el = renderTransacaoItem(t);
      recentesList.prepend(el);
    });
  }

  // ===== Modal actions =====
  const btnNova = document.getElementById("btnNovaTransacao");
  const modal = document.getElementById("trxModal");
  const closeBtn = document.getElementById("trxClose");
  const cancelBtn = document.getElementById("trxCancel");
  const form = document.getElementById("trxForm");

  const inNome = document.getElementById("trxNome");
  const inTipo = document.getElementById("trxTipo");
  const inValor = document.getElementById("trxValor");
  const inData = document.getElementById("trxData");
  const inHora = document.getElementById("trxHora");

  function openModal(){
    if(!modal) return;
    modal.classList.add("is-open");
    modal.setAttribute("aria-hidden", "false");

    // defaults: hoje e agora
    const now = new Date();
    inData.value = `${now.getFullYear()}-${pad2(now.getMonth()+1)}-${pad2(now.getDate())}`;
    inHora.value = `${pad2(now.getHours())}:${pad2(now.getMinutes())}`;
    inNome.focus();
  }

  function closeModal(){
    if(!modal) return;
    modal.classList.remove("is-open");
    modal.setAttribute("aria-hidden", "true");
    form.reset();
  }

  btnNova && btnNova.addEventListener("click", (e) => {
    e.preventDefault();
    openModal();
  });

  closeBtn && closeBtn.addEventListener("click", closeModal);
  cancelBtn && cancelBtn.addEventListener("click", closeModal);

  modal && modal.addEventListener("click", (e) => {
    const target = e.target;
    if(target && target.dataset && target.dataset.close === "1") closeModal();
  });

  form && form.addEventListener("submit", (e) => {
    e.preventDefault();

    const nome = (inNome.value || "").trim();
    const tipo = inTipo.value;
    const valor = Number(inValor.value);

    if(!nome || !tipo || !Number.isFinite(valor)){
      return;
    }

    const d = inData.value; // yyyy-mm-dd
    const h = inHora.value; // hh:mm

    // Labels pro layout (igual exemplo ‚ÄúHoje 14:30‚Äù etc.)
    const dataObj = new Date(d + "T" + (h || "00:00") + ":00");
    const hoje = new Date();
    const sameDay = dataObj.toDateString() === hoje.toDateString();
    const dataLabel = sameDay ? "Hoje" : `${pad2(dataObj.getDate())}/${pad2(dataObj.getMonth()+1)}`;
    const horaLabel = h;

    const trx = {
      id: generateId(),             // pronto pro banco
      nome,
      tipo,
      valor,
      dataISO: dataObj.toISOString(),// pronto pro banco
      dataLabel,
      horaLabel
    };

    // salva
    const list = loadTransacoes();
    list.push(trx);
    saveTransacoes(list);

    // renderiza no topo
    if(recentesList){
      const el = renderTransacaoItem(trx);
      recentesList.prepend(el);
    }

    closeModal();
  });

  // Inicializa (carrega transa√ß√µes salvas)
  renderRecentes();
</script>
<script>
  // ===== LISTAS (Dashboard) - usa o MESMO LS_KEY do Minhas Listas =====
  const LISTS_KEY = "kash_lists_v1";

  const loadListsDash = () => {
    try { return JSON.parse(localStorage.getItem(LISTS_KEY) || "[]"); }
    catch { return []; }
  };
  const saveListsDash = (lists) => localStorage.setItem(LISTS_KEY, JSON.stringify(lists));

  const dashRows = document.getElementById("dashListsRows");
  const btnDashNova = document.getElementById("dashNovaLista");

  const makeIdList = () =>
    "lst_" + Date.now().toString(36) + "_" + Math.random().toString(36).slice(2, 8);

  const formatBRL2 = (n) =>
    Number(n || 0).toLocaleString("pt-BR", { style:"currency", currency:"BRL" });

  const daysAgoLabel = (iso) => {
    if (!iso) return "Criado agora";
    const d = new Date(iso);
    const diff = Math.max(0, Math.floor((Date.now() - d.getTime()) / (1000*60*60*24)));
    if (diff === 0) return "Criado hoje";
    if (diff === 1) return "Criado h√° 1 dia";
    return `Criado h√° ${diff} dias`;
  };

  const statusForPct = (pct) => {
    if (pct >= 100) return { text:"Completa", cls:"is-green" };
    if (pct >= 80)  return { text:"Quase Completa", cls:"is-teal" };
    return { text:"Em Andamento", cls:"is-warn" };
  };

  const progressColorCls = (pct) => {
    if (pct >= 100) return "is-green";
    if (pct >= 80) return "is-purple";
    if (pct >= 50) return "is-blue";
    return "is-orange";
  };

const pickDashIcon = (title = "") => {
  const t = title.toLowerCase();

  if (t.includes("super") || t.includes("mercado") || t.includes("compra")) {
    return { icon: "üõí", cls: "list-icon--blue" };
  }
  if (t.includes("conta") || t.includes("casa") || t.includes("aluguel")) {
    return { icon: "üè†", cls: "list-icon--purple" };
  }
  if (t.includes("viagem") || t.includes("f√©rias") || t.includes("ferias")) {
    return { icon: "‚úàÔ∏è", cls: "list-icon--orange" };
  }
  if (t.includes("academ") || t.includes("sa√∫de") || t.includes("saude")) {
    return { icon: "üèãÔ∏è", cls: "list-icon--green" };
  }
  return { icon: "üßæ", cls: "list-icon--blue" };
};

function renderDashLists() {
  if (!dashRows) return;

  const lists = loadListsDash();

  dashRows.innerHTML = lists
    .map((l) => {
      const itemsCount = (l.items?.length || 0);
      const pct = Math.round(Number(l.pct || 0));
      const status = statusForPct(pct);
      const progCls = progressColorCls(pct);

      const { icon, cls } = pickDashIcon(l.title || "");

      const money = formatBRL2(l.estimated ?? l.orcamento ?? 0);

      return `
        <div class="row" data-id="${l.id}">
          <div class="cell cell--list">
            <div class="list-icon ${cls}">${icon}</div>
            <div>
              <div class="list-name">${l.title || "Lista"}</div>
              <div class="list-sub">${daysAgoLabel(l.createdAt)}</div>
            </div>
          </div>

          <div class="cell">
            <div class="items">
              <div class="items__num">${itemsCount}</div>
              <div class="items__txt">itens</div>
            </div>
          </div>

          <div class="cell money">${money}</div>

          <div class="cell">
            <div class="progress">
              <div class="progress__bar">
                <div class="progress__fill ${progCls}" style="width: ${Math.min(100, Math.max(0, pct))}%"></div>
              </div>
              <div class="progress__pct">${pct}%</div>
            </div>
          </div>

          <div class="cell">
            <span class="status ${status.cls}">${status.text}</span>
          </div>

          <div class="cell cell--menu">‚ãÆ</div>
        </div>
      `;
    })
    .join("");
}


  function renderDashLists(){
    if (!dashRows) return;
    const lists = loadListsDash();

    dashRows.innerHTML = lists.map(l => {
      const itemsCount = (l.items?.length || 0);
      const pct = Math.round(Number(l.pct || 0));
      const status = statusForPct(pct);

      return `
        <div class="row" data-id="${l.id}">
          <div class="cell cell--list">
            <div class="list-icon list-icon--blue">üßæ</div>
            <div>
              <div class="list-name">${l.title || "Lista"}</div>
              <div class="list-sub">${daysAgoLabel(l.createdAt)}</div>
            </div>
          </div>

          <div class="cell">
            <div class="items">
              <div class="items__num">${itemsCount}</div>
              <div class="items__txt">itens</div>
            </div>
          </div>

          <div class="cell money">${formatBRL2(l.estimated || 0)}</div>

          <div class="cell">
            <div class="progress">
              <div class="progress__bar">
                <div class="progress__fill ${progressColorCls(pct)}" style="width:${pct}%"></div>
              </div>
              <div class="progress__pct">${pct}%</div>
            </div>
          </div>

          <div class="cell">
            <span class="status ${status.cls}">${status.text}</span>
          </div>

          <div class="cell cell--menu">
            <div class="kebab-wrap">
              <button class="kebab" type="button" data-kebab="1">‚ãÆ</button>
              <div class="kebab-menu" role="menu">
                <button type="button" data-edit="1">Editar lista</button>
                <button type="button" class="danger" data-del="1">Excluir lista</button>
              </div>
            </div>
          </div>
        </div>
      `;
    }).join("");
  }

  // ===== Reaproveita o modal de lista (mesmo do Minhas Listas) =====
  // IDs esperados no modal: #modalNovaLista, #nl_nome, #nl_disponivel, #itemsTable,
  // #btnAddItem, #btnSalvarLista, #nl_estimado, #nl_pct, #nl_bar
  const qsL = (s) => document.querySelector(s);

  const modalL = qsL("#modalNovaLista");
  const inNomeL = qsL("#nl_nome");
  const inDispL = qsL("#nl_disponivel");
  const itemsTableL = qsL("#itemsTable");
  const btnAddItemL = qsL("#btnAddItem");
  const btnSalvarL = qsL("#btnSalvarLista");

  const estElL = qsL("#nl_estimado");
  const pctElL = qsL("#nl_pct");
  const barElL = qsL("#nl_bar");

  let editingIdDash = null;
  let itemsDash = [];

  const parseBRL = (str) => {
    if (!str) return 0;
    const cleaned = String(str)
      .replace(/\s/g, "")
      .replace("R$", "")
      .replace(/\./g, "")
      .replace(",", ".");
    const n = Number(cleaned);
    return Number.isFinite(n) ? n : 0;
  };

  const escapeHtml = (s) =>
    String(s || "").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;");

  const openListModal = () => {
    if (!modalL) return;
    modalL.classList.add("is-open");
    modalL.setAttribute("aria-hidden", "false");
  };
  const closeListModal = () => {
    if (!modalL) return;
    modalL.classList.remove("is-open");
    modalL.setAttribute("aria-hidden", "true");
  };

  const renderItemsDash = () => {
    if (!itemsTableL) return;
    itemsTableL.innerHTML = itemsDash.map((it, idx) => `
      <div class="item-row" data-idx="${idx}">
        <input class="item-name" type="text" placeholder="Item ${idx+1}" value="${escapeHtml(it.name)}" />
        <input class="item-value" type="text" inputmode="decimal" placeholder="0,00" value="${it.value ? String(it.value).replace(".", ",") : ""}" />
        <button class="item-del" type="button" title="Remover">‚úï</button>
      </div>
    `).join("");
  };

  const recalcDash = () => {
    const totalEstimado = itemsDash.reduce((acc, it) => acc + (Number(it.value) || 0), 0);
    const disponivel = parseBRL(inDispL?.value);

    const pct = totalEstimado > 0 ? Math.min(100, Math.max(0, (disponivel / totalEstimado) * 100)) : 0;

    if (estElL) estElL.textContent = formatBRL2(totalEstimado);
    if (pctElL) pctElL.textContent = `${Math.round(pct)}%`;
    if (barElL) barElL.style.width = `${pct}%`;
  };

  // abrir modal pelo bot√£o do dashboard
  btnDashNova?.addEventListener("click", () => {
    editingIdDash = null;
    if (btnSalvarL) btnSalvarL.textContent = "Criar Lista";

    if (inNomeL) inNomeL.value = "";
    if (inDispL) inDispL.value = "";
    itemsDash = [{ name:"", value:0 }];

    renderItemsDash();
    recalcDash();
    openListModal();
  });

  // fechar clicando fora (o modal j√° usa data-close no seu HTML)
  modalL?.addEventListener("click", (e) => {
    const t = e.target;
    if (t && t.dataset && t.dataset.close) closeListModal();
  });

  // listeners dos itens
  itemsTableL?.addEventListener("input", (e) => {
    const row = e.target.closest(".item-row");
    if (!row) return;
    const idx = Number(row.dataset.idx);
    if (e.target.classList.contains("item-name")) itemsDash[idx].name = e.target.value;
    if (e.target.classList.contains("item-value")) itemsDash[idx].value = parseBRL(e.target.value);
    recalcDash();
  });

  itemsTableL?.addEventListener("click", (e) => {
    if (!e.target.classList.contains("item-del")) return;
    const row = e.target.closest(".item-row");
    const idx = Number(row.dataset.idx);
    itemsDash.splice(idx, 1);
    if (!itemsDash.length) itemsDash = [{ name:"", value:0 }];
    renderItemsDash();
    recalcDash();
  });

  btnAddItemL?.addEventListener("click", () => {
    itemsDash.push({ name:"", value:0 });
    renderItemsDash();
    recalcDash();
  });

  inDispL?.addEventListener("input", recalcDash);

  // salvar (criar/editar)
  btnSalvarL?.addEventListener("click", () => {
    const title = (inNomeL?.value || "").trim();
    const disponivel = parseBRL(inDispL?.value);

    const cleanItems = itemsDash
      .map(i => ({ name:(i.name||"").trim(), value:Number(i.value)||0 }))
      .filter(i => i.name || i.value > 0);

    const estimated = cleanItems.reduce((a, i) => a + i.value, 0);
    const pct = estimated > 0 ? Math.round(Math.min(100, Math.max(0, (disponivel / estimated) * 100))) : 0;

    if (!title) { inNomeL?.focus(); return; }

    const lists = loadListsDash();

    if (editingIdDash) {
      const idx = lists.findIndex(l => l.id === editingIdDash);
      if (idx >= 0) {
        lists[idx] = { ...lists[idx], title, disponivel, items: cleanItems, estimated, pct };
        saveListsDash(lists);
        renderDashLists();
        closeListModal();
        editingIdDash = null;
        if (btnSalvarL) btnSalvarL.textContent = "Criar Lista";
        return;
      }
    }

    const id = makeIdList();
    lists.unshift({ id, title, disponivel, items: cleanItems, estimated, pct, createdAt: new Date().toISOString() });
    saveListsDash(lists);

    renderDashLists();
    closeListModal();
  });

  // menu ‚ãÆ no dashboard (editar / excluir)
  document.addEventListener("click", (e) => {
    const kebabBtn = e.target.closest("[data-kebab]");
    const editBtn = e.target.closest("[data-edit]");
    const delBtn  = e.target.closest("[data-del]");

    if (!kebabBtn && !editBtn && !delBtn) {
      document.querySelectorAll(".kebab-menu.is-open").forEach(m => m.classList.remove("is-open"));
      return;
    }

    if (kebabBtn) {
      const wrap = kebabBtn.closest(".kebab-wrap");
      const menu = wrap?.querySelector(".kebab-menu");
      if (!menu) return;

      document.querySelectorAll(".kebab-menu.is-open").forEach(m => {
        if (m !== menu) m.classList.remove("is-open");
      });

      menu.classList.toggle("is-open");
      return;
    }

    const row = e.target.closest(".row");
    const id = row?.dataset?.id;
    if (!id) return;

    if (editBtn) {
      const lists = loadListsDash();
      const found = lists.find(l => l.id === id);
      if (!found) return;

      editingIdDash = id;
      if (btnSalvarL) btnSalvarL.textContent = "Salvar Altera√ß√µes";

      if (inNomeL) inNomeL.value = found.title || "";
      if (inDispL) inDispL.value = String(found.disponivel || "").replace(".", ",");
      itemsDash = Array.isArray(found.items) && found.items.length ? found.items : [{ name:"", value:0 }];

      renderItemsDash();
      recalcDash();
      openListModal();

      row.querySelectorAll(".kebab-menu.is-open").forEach(m => m.classList.remove("is-open"));
      return;
    }

    if (delBtn) {
      const ok = confirm("Excluir esta lista? Essa a√ß√£o n√£o pode ser desfeita.");
      if (!ok) return;

      const lists = loadListsDash().filter(l => l.id !== id);
      saveListsDash(lists);
      renderDashLists();
    }
  });

  // boot
  renderDashLists();
</script>

<script>
function logout(){
  localStorage.clear();
  window.location.href = "login.html";
}
</script>

  </body>
</html>
